/*
 * EMService
 * Easemob Rest API
 *
 * The version of the OpenAPI document: 1.0.0
 * 
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */


package com.easemob.im.api;

import com.easemob.im.ApiException;
import com.easemob.im.api.model.EMUploadChatFileResult;
import org.junit.jupiter.api.Test;
import org.junit.platform.commons.util.ClassLoaderUtils;

import java.io.File;
import java.util.Objects;

import static org.junit.jupiter.api.Assertions.*;

/**
 * API tests for ChatFileApi
 */
public class ChatFileApiTest extends AbstractTest {

    private final ChatFileApi api = new ChatFileApi();

    public ChatFileApiTest() {
    }

    /**
     * 下载文件/下载缩略图
     *
     * 可利用该方法下载图片、语音、视频或其他类型的文件。文档介绍：https://docs-im-beta.easemob.com/document/server-side/message_download.html#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6
     *
     * @throws ApiException if the Api call fails
     */
    @Test
    public void downloadChatFileTest() throws ApiException {
        File _file = new File(Objects.requireNonNull(
                ClassLoaderUtils.getDefaultClassLoader().getResource("upload/blue.png")).getPath());
        Boolean restrictAccess = true;

        EMUploadChatFileResult uploadChatFileResult = assertDoesNotThrow(() -> api.uploadChatFile(restrictAccess, _file));
        assertNotNull(uploadChatFileResult);
        assertNotNull(uploadChatFileResult.getEntities());
        assertNotNull(uploadChatFileResult.getEntities().get(0));

        String fileUuid = uploadChatFileResult.getEntities().get(0).getUuid();
        String shareSecret = uploadChatFileResult.getEntities().get(0).getShareSecret();
        File file = assertDoesNotThrow(() -> api.downloadChatFile(fileUuid, shareSecret, false));
        assertNotNull(file);
        assertTrue(file.delete());
    }

    /**
     * 上传文件
     *
     * 对于附件类型的消息，如图片、语音、视频或其他类型文件，发送消息前需上传文件。文档介绍：https://docs-im-beta.easemob.com/document/server-side/message_download.html#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6
     *
     * @throws ApiException if the Api call fails
     */
    @Test
    public void uploadChatFileTest() throws ApiException {
        File _file = new File(Objects.requireNonNull(
                ClassLoaderUtils.getDefaultClassLoader().getResource("upload/blue.png")).getPath());
        Boolean restrictAccess = false;

        EMUploadChatFileResult uploadChatFileResult = assertDoesNotThrow(() -> api.uploadChatFile(restrictAccess, _file));
        assertNotNull(uploadChatFileResult);
        assertNotNull(uploadChatFileResult.getEntities());
        assertNotNull(uploadChatFileResult.getEntities().get(0));
        assertNotNull(uploadChatFileResult.getEntities().get(0).getUuid());
    }

}
